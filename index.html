<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›í˜• ëŒë¦¼íŒ</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .title {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: bold;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        input, select, button {
            padding: 10px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .color-scheme-btn {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            min-width: 120px;
        }

        .color-scheme-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .color-scheme-btn.rainbow {
            background: linear-gradient(45deg, #ff9a9e, #fecfef, #fecfef, #a8edea, #fed6e3);
        }

        .main-content {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .wheel-container {
            flex: 1;
            min-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .wheel-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        .wheel {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            position: relative;
            transition: transform 3s cubic-bezier(0.23, 1, 0.32, 1);
            border: 4px solid #333;
            overflow: hidden;
        }

        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            color: #333;
            text-align: center;
            padding: 10px;
            box-sizing: border-box;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: #333;
            border-radius: 50%;
            z-index: 10;
        }

        .wheel-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #ff4757;
            z-index: 5;
        }

        .spin-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .spin-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }

        .spin-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .participants-section {
            flex: 1;
            min-width: 300px;
        }

        .participants-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .file-upload-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px dashed #667eea;
            border-radius: 10px;
            background: #f8f9ff;
            text-align: center;
        }

        .file-upload-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }

        .file-upload-btn:hover {
            background: #5a67d8;
        }

        .reset-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }

        .reset-btn:hover {
            background: #ff5252;
        }

        .file-input {
            display: none;
        }

        .upload-info {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }

        .upload-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
        }

        .upload-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .upload-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .participants-container {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 15px;
            background: #f8f9fa;
        }

        .participant-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .participant-input input {
            flex: 1;
            margin: 0;
        }

        .remove-btn {
            background: #ff4757;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            background: #ff3742;
        }

        .add-btn {
            background: #2ed573;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            width: 100%;
        }

        .add-btn:hover {
            background: #26d063;
        }

        .apply-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            width: 100%;
            font-size: 1.1rem;
        }

        .apply-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .popup-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: popIn 0.5s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .popup-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .popup-winner {
            font-size: 3rem;
            font-weight: bold;
            color: #ff6b6b;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: winner-spin 3s ease-out forwards;
            transform-style: preserve-3d;
        }

        @keyframes winner-spin {
            0% {
                transform: rotateY(0deg) scale(1);
            }
            8.33% {
                transform: rotateY(90deg) scale(1.05);
            }
            16.67% {
                transform: rotateY(180deg) scale(1.1);
            }
            25% {
                transform: rotateY(270deg) scale(1.05);
            }
            33.33% {
                transform: rotateY(360deg) scale(1);
            }
            41.67% {
                transform: rotateY(450deg) scale(1.05);
            }
            50% {
                transform: rotateY(540deg) scale(1.1);
            }
            58.33% {
                transform: rotateY(630deg) scale(1.05);
            }
            66.67% {
                transform: rotateY(720deg) scale(1);
            }
            75% {
                transform: rotateY(810deg) scale(1.05);
            }
            83.33% {
                transform: rotateY(900deg) scale(1.1);
            }
            91.67% {
                transform: rotateY(990deg) scale(1.05);
            }
            100% {
                transform: rotateY(1080deg) scale(1);
            }
        }

        .popup-close {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        .popup-close:hover {
            background: #5a67d8;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #f0f;
            animation: confetti-fall 4s linear infinite;
            z-index: 1002;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(400px) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti-1 { background: #ff6b6b; animation-delay: 0s; }
        .confetti-2 { background: #4ecdc4; animation-delay: 0.1s; }
        .confetti-3 { background: #45b7d1; animation-delay: 0.2s; }
        .confetti-4 { background: #96ceb4; animation-delay: 0.3s; }
        .confetti-5 { background: #ffeaa7; animation-delay: 0.4s; }
        .confetti-6 { background: #dda0dd; animation-delay: 0.5s; }
        .confetti-7 { background: #98d8c8; animation-delay: 0.6s; }
        .confetti-8 { background: #f7dc6f; animation-delay: 0.7s; }
        .confetti-9 { background: #bb8fce; animation-delay: 0.8s; }
        .confetti-10 { background: #85c1e9; animation-delay: 0.9s; }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .wheel {
                width: 300px;
                height: 300px;
            }
            
            .wheel-segment {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ğŸ¯ ì›í˜• ëŒë¦¼íŒ</h1>
        
        <div class="controls">
            <div class="control-group">
                <label>ì°¸ê°€ì ìˆ˜</label>
                <input type="number" id="segmentCount" min="2" max="101" value="8">
            </div>
            <div class="control-group">
                <label>ìƒ‰ìƒ í…Œë§ˆ</label>
                <button class="color-scheme-btn" id="colorScheme" onclick="toggleColorScheme()">ê¸°ë³¸ ìƒ‰ìƒ</button>
            </div>
        </div>

        <div class="main-content">
            <div class="wheel-container">
                <div class="wheel-wrapper">
                    <div class="wheel-pointer"></div>
                    <div class="wheel" id="wheel"></div>
                    <div class="wheel-center"></div>
                </div>
                <button class="spin-btn" id="spinBtn" onclick="spinWheel()">ëŒë¦¼íŒ ëŒë¦¬ê¸°! ğŸ²</button>
            </div>

            <div class="participants-section">
                <h3 class="participants-title">ì°¸ê°€ì ëª©ë¡</h3>
                
                <div class="file-upload-section">
                    <div>ğŸ“ íŒŒì¼ì—ì„œ ì°¸ê°€ì ë¶ˆëŸ¬ì˜¤ê¸°</div>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <input type="file" id="fileInput" class="file-input" accept=".txt,.csv" onchange="handleFileUpload(event)">
                        <button class="file-upload-btn" onclick="document.getElementById('fileInput').click()">íŒŒì¼ ì„ íƒ</button>
                        <button class="reset-btn" onclick="resetToDefault()">ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°</button>
                    </div>
                    <div class="upload-info">
                        ì§€ì› í˜•ì‹: í…ìŠ¤íŠ¸(.txt), CSV(.csv)<br>
                        ê° ì¤„ë§ˆë‹¤ í•œ ëª…ì”© ë˜ëŠ” ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì‘ì„±í•´ì£¼ì„¸ìš”<br>
                        <strong>ğŸ’¡ í•œê¸€ ê¹¨ì§ ë°©ì§€:</strong> ë©”ëª¨ì¥ì—ì„œ "ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥" â†’ ì¸ì½”ë”©ì„ "UTF-8"ë¡œ ì„ íƒí•˜ì—¬ ì €ì¥
                    </div>
                    <div id="uploadStatus"></div>
                </div>

                <div class="participants-container">
                    <div id="participantsList"></div>
                    <button class="add-btn" onclick="addParticipant()">+ ì°¸ê°€ì ì¶”ê°€</button>
                    <button class="apply-btn" onclick="applyParticipantsToWheel()">ğŸ¯ ì›íŒì— ì ìš©í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <div class="popup" id="popup">
        <div class="popup-content">
            <div class="popup-title">ğŸ‰ ë‹¹ì²¨ì ë°œí‘œ! ğŸ‰</div>
            <div class="popup-winner" id="popupWinner"></div>
            <button class="popup-close" onclick="closePopup()">í™•ì¸</button>
        </div>
    </div>

    <script>
        let isRainbow = false;
        let isSpinning = false;
        let participants = ['ì°¸ê°€ì1', 'ì°¸ê°€ì2', 'ì°¸ê°€ì3', 'ì°¸ê°€ì4', 'ì°¸ê°€ì5', 'ì°¸ê°€ì6', 'ì°¸ê°€ì7', 'ì°¸ê°€ì8'];

        const pastelColors = [
            '#FFB3BA', '#FFDFBA', '#FFFFBA', '#BAFFC9', 
            '#BAE1FF', '#D4BAFF', '#FFBAF3', '#FFB3E6'
        ];

        function initializeParticipants() {
            updateParticipantsList();
            updateWheel();
        }

        function updateParticipantsList() {
            const container = document.getElementById('participantsList');
            container.innerHTML = '';
            
            participants.forEach((participant, index) => {
                const div = document.createElement('div');
                div.className = 'participant-input';
                div.innerHTML = `
                    <input type="text" value="${participant}" onchange="updateParticipant(${index}, this.value)" placeholder="ì°¸ê°€ì ì´ë¦„">
                    ${participants.length > 2 ? `<button class="remove-btn" onclick="removeParticipant(${index})">Ã—</button>` : ''}
                `;
                container.appendChild(div);
            });
        }

        function addParticipant() {
            if (participants.length < 101) {
                participants.push(`ì°¸ê°€ì${participants.length + 1}`);
                document.getElementById('segmentCount').value = participants.length;
                updateParticipantsList();
                // updateWheel(); ì œê±° - ì°¸ê°€ì ì¶”ê°€ ì‹œ ìë™ìœ¼ë¡œ ì›íŒì— ì ìš©í•˜ì§€ ì•ŠìŒ
            }
        }

        function removeParticipant(index) {
            if (participants.length > 2) {
                participants.splice(index, 1);
                document.getElementById('segmentCount').value = participants.length;
                updateParticipantsList();
                // updateWheel(); ì œê±° - ì°¸ê°€ì ì œê±° ì‹œ ìë™ìœ¼ë¡œ ì›íŒì— ì ìš©í•˜ì§€ ì•ŠìŒ
            }
        }

        function updateParticipant(index, value) {
            participants[index] = value || `ì°¸ê°€ì${index + 1}`;
            // updateWheel(); ì œê±° - ì°¸ê°€ì ì´ë¦„ ìˆ˜ì • ì‹œ ìë™ìœ¼ë¡œ ì›íŒì— ì ìš©í•˜ì§€ ì•ŠìŒ
        }

        document.getElementById('segmentCount').addEventListener('change', function() {
            const count = parseInt(this.value);
            if (count >= 2 && count <= 101) {
                while (participants.length < count) {
                    participants.push(`ì°¸ê°€ì${participants.length + 1}`);
                }
                while (participants.length > count) {
                    participants.pop();
                }
                updateParticipantsList();
                // updateWheel(); ì œê±° - ì°¸ê°€ì ìˆ˜ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ì›íŒì— ì ìš©í•˜ì§€ ì•ŠìŒ
            }
        });

        function toggleColorScheme() {
            isRainbow = !isRainbow;
            const btn = document.getElementById('colorScheme');
            if (isRainbow) {
                btn.textContent = 'ë¬´ì§€ê°œ ìƒ‰ìƒ';
                btn.classList.add('rainbow');
            } else {
                btn.textContent = 'ê¸°ë³¸ ìƒ‰ìƒ';
                btn.classList.remove('rainbow');
            }
            updateWheel();
        }

        function updateWheel() {
            const wheel = document.getElementById('wheel');
            const segmentCount = participants.length;
            const anglePerSegment = 360 / segmentCount;
            
            wheel.innerHTML = '';
            
            // SVGë¥¼ ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ ì›í˜• ë¶„í• 
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '100%');
            svg.setAttribute('height', '100%');
            svg.setAttribute('viewBox', '0 0 400 400');
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            
            const centerX = 200;
            const centerY = 200;
            const radius = 190;
            
            for (let i = 0; i < segmentCount; i++) {
                const startAngle = (i * anglePerSegment - 90) * Math.PI / 180;
                const endAngle = ((i + 1) * anglePerSegment - 90) * Math.PI / 180;
                
                const x1 = centerX + radius * Math.cos(startAngle);
                const y1 = centerY + radius * Math.sin(startAngle);
                const x2 = centerX + radius * Math.cos(endAngle);
                const y2 = centerY + radius * Math.sin(endAngle);
                
                const largeArcFlag = anglePerSegment > 180 ? 1 : 0;
                
                const pathData = [
                    `M ${centerX} ${centerY}`,
                    `L ${x1} ${y1}`,
                    `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                    'Z'
                ].join(' ');
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                
                if (isRainbow) {
                    path.setAttribute('fill', pastelColors[i % pastelColors.length]);
                } else {
                    path.setAttribute('fill', i % 2 === 0 ? '#ffffff' : '#f5f5dc');
                }
                
                path.setAttribute('stroke', '#333');
                path.setAttribute('stroke-width', '2');
                
                svg.appendChild(path);
                
                // í…ìŠ¤íŠ¸ ì¶”ê°€
                const textAngle = (i + 0.5) * anglePerSegment - 90;
                const textRadius = radius * 0.7;
                const textX = centerX + textRadius * Math.cos(textAngle * Math.PI / 180);
                const textY = centerY + textRadius * Math.sin(textAngle * Math.PI / 180);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', textX);
                text.setAttribute('y', textY);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.setAttribute('fill', '#333');
                text.setAttribute('font-weight', 'bold');
                text.setAttribute('font-family', 'Segoe UI, sans-serif');
                
                // ê¸€ì í¬ê¸° ì¡°ì ˆ
                let fontSize;
                if (segmentCount > 30) fontSize = '8px';
                else if (segmentCount > 20) fontSize = '10px';
                else if (segmentCount > 10) fontSize = '12px';
                else fontSize = '14px';
                
                text.setAttribute('font-size', fontSize);
                
                // í…ìŠ¤íŠ¸ íšŒì „
                if (textAngle > 90 && textAngle < 270) {
                    text.setAttribute('transform', `rotate(${textAngle + 180} ${textX} ${textY})`);
                } else {
                    text.setAttribute('transform', `rotate(${textAngle} ${textX} ${textY})`);
                }
                
                text.textContent = participants[i];
                svg.appendChild(text);
            }
            
            wheel.appendChild(svg);
        }

        function spinWheel() {
            if (isSpinning) return;
            
            isSpinning = true;
            const spinBtn = document.getElementById('spinBtn');
            spinBtn.disabled = true;
            spinBtn.textContent = 'ëŒë¦¬ëŠ” ì¤‘...';
            
            const wheel = document.getElementById('wheel');
            const segmentCount = participants.length;
            const anglePerSegment = 360 / segmentCount;
            
            const minSpins = 5;
            const maxSpins = 10;
            const spins = Math.random() * (maxSpins - minSpins) + minSpins;
            const finalAngle = Math.random() * 360;
            const totalRotation = spins * 360 + finalAngle;
            
            wheel.style.transform = `rotate(${totalRotation}deg)`;
            
            setTimeout(() => {
                const normalizedAngle = (360 - (finalAngle % 360)) % 360;
                const winnerIndex = Math.floor(normalizedAngle / anglePerSegment);
                const winner = participants[winnerIndex];
                
                showWinner(winner);
                
                isSpinning = false;
                spinBtn.disabled = false;
                spinBtn.textContent = 'ëŒë¦¼íŒ ëŒë¦¬ê¸°! ğŸ²';
            }, 3000);
        }

        function showWinner(winner) {
            document.getElementById('popupWinner').textContent = winner;
            document.getElementById('popup').style.display = 'flex';
            createConfetti();
            playWinnerSound();
        }

        function playWinnerSound() {
            // Web Audio APIë¥¼ ì‚¬ìš©í•œ ì¶•í•˜ ì‚¬ìš´ë“œ ìƒì„±
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // íŒ¡íŒŒë ˆ ê°™ì€ ì¶•í•˜ ì‚¬ìš´ë“œ ìƒì„±
                const playNote = (frequency, startTime, duration) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(frequency, startTime);
                    oscillator.type = 'triangle';
                    
                    gainNode.gain.setValueAtTime(0, startTime);
                    gainNode.gain.linearRampToValueAtTime(0.3, startTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + duration);
                };
                
                // ì¶•í•˜ ë©œë¡œë”” (ë„-ë¯¸-ì†”-ë„)
                const now = audioContext.currentTime;
                playNote(523.25, now, 0.3); // ë„
                playNote(659.25, now + 0.15, 0.3); // ë¯¸
                playNote(783.99, now + 0.3, 0.3); // ì†”
                playNote(1046.50, now + 0.45, 0.5); // ë†’ì€ ë„
                
                // ë“œëŸ¼ íš¨ê³¼
                const createDrum = (startTime) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    const filter = audioContext.createBiquadFilter();
                    
                    oscillator.connect(filter);
                    filter.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(60, startTime);
                    oscillator.frequency.exponentialRampToValueAtTime(30, startTime + 0.1);
                    oscillator.type = 'triangle';
                    
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(200, startTime);
                    
                    gainNode.gain.setValueAtTime(0.5, startTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.2);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + 0.2);
                };
                
                createDrum(now + 0.6);
                createDrum(now + 0.8);
                
            } catch (error) {
                console.log('ìŒí–¥ íš¨ê³¼ë¥¼ ì¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', error);
            }
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd', '#98d8c8', '#f7dc6f', '#bb8fce', '#85c1e9'];
            const popupContent = document.querySelector('.popup-content');
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 90 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 3) + 's';
                    confetti.style.animationDelay = Math.random() * 1 + 's';
                    
                    // ë‹¤ì–‘í•œ ëª¨ì–‘ ë§Œë“¤ê¸°
                    const shapes = ['circle', 'square', 'triangle', 'star'];
                    const shape = shapes[Math.floor(Math.random() * shapes.length)];
                    
                    if (shape === 'circle') {
                        confetti.style.borderRadius = '50%';
                    } else if (shape === 'triangle') {
                        confetti.style.width = '0';
                        confetti.style.height = '0';
                        confetti.style.borderLeft = '5px solid transparent';
                        confetti.style.borderRight = '5px solid transparent';
                        confetti.style.borderBottom = '10px solid ' + confetti.style.background;
                        confetti.style.background = 'transparent';
                    } else if (shape === 'star') {
                        confetti.innerHTML = 'â˜…';
                        confetti.style.background = 'transparent';
                        confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.fontSize = '12px';
                        confetti.style.width = 'auto';
                        confetti.style.height = 'auto';
                    }
                    
                    popupContent.appendChild(confetti);
                    
                    // 5ì´ˆ í›„ ì œê±°
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }, 5000);
                }, i * 100);
            }
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
            // ë‚¨ì€ ì½˜í˜í‹° ì œê±°
            const confettis = document.querySelectorAll('.confetti');
            confettis.forEach(confetti => {
                if (confetti.parentNode) {
                    confetti.parentNode.removeChild(confetti);
                }
            });
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.innerHTML = '<div class="upload-status">íŒŒì¼ì„ ì½ëŠ” ì¤‘...</div>';

            const fileName = file.name.toLowerCase();
            const fileExtension = fileName.split('.').pop();

            if (fileExtension === 'txt' || fileExtension === 'csv') {
                handleTextFile(file);
            } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                handleExcelFile(file);
            } else if (fileExtension === 'docx' || fileExtension === 'doc') {
                handleWordFile(file);
            } else {
                showUploadError('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
            }
        }

        function handleTextFile(file) {
            // ë¨¼ì € UTF-8ë¡œ ì‹œë„
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let text = e.target.result;
                    
                    // í•œê¸€ì´ ê¹¨ì¡ŒëŠ”ì§€ í™•ì¸ (ë¬¼ìŒí‘œë‚˜ ì´ìƒí•œ ë¬¸ìê°€ ë§ì´ í¬í•¨ëœ ê²½ìš°)
                    const brokenChars = (text.match(/[ï¿½?]/g) || []).length;
                    const totalChars = text.length;
                    
                    if (brokenChars > totalChars * 0.1 || text.includes('Ã¯Â»Â¿')) {
                        // UTF-8ë¡œ ì½ê¸° ì‹¤íŒ¨, EUC-KRë¡œ ë‹¤ì‹œ ì‹œë„
                        tryReadWithEUCKR(file);
                        return;
                    }
                    
                    const names = parseTextContent(text);
                    updateParticipantsFromFile(names);
                } catch (error) {
                    // UTF-8 ì‹¤íŒ¨ì‹œ EUC-KRë¡œ ì¬ì‹œë„
                    tryReadWithEUCKR(file);
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function tryReadWithEUCKR(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const arrayBuffer = e.target.result;
                    const decoder = new TextDecoder('euc-kr');
                    const text = decoder.decode(arrayBuffer);
                    
                    const names = parseTextContent(text);
                    updateParticipantsFromFile(names);
                } catch (error) {
                    // EUC-KRë„ ì‹¤íŒ¨í•˜ë©´ CP949 ì‹œë„
                    tryReadWithCP949(file);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function tryReadWithCP949(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const arrayBuffer = e.target.result;
                    // CP949ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ EUC-KRë¡œ ëŒ€ì²´
                    const decoder = new TextDecoder('euc-kr');
                    let text = decoder.decode(arrayBuffer);
                    
                    // ì—¬ì „íˆ ê¹¨ì§„ë‹¤ë©´ ë°”ì´íŠ¸ë¥¼ ì§ì ‘ ì²˜ë¦¬
                    if (text.includes('ï¿½')) {
                        text = handleBrokenEncoding(arrayBuffer);
                    }
                    
                    const names = parseTextContent(text);
                    updateParticipantsFromFile(names);
                } catch (error) {
                    showUploadError('íŒŒì¼ ì¸ì½”ë”©ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. UTF-8 ë˜ëŠ” EUC-KR ì¸ì½”ë”©ìœ¼ë¡œ ì €ì¥ëœ íŒŒì¼ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function handleBrokenEncoding(arrayBuffer) {
            // ë°”ì´íŠ¸ ë°°ì—´ì„ ì§ì ‘ ì²˜ë¦¬í•˜ì—¬ í•œê¸€ ë³µêµ¬ ì‹œë„
            const bytes = new Uint8Array(arrayBuffer);
            let result = '';
            
            for (let i = 0; i < bytes.length; i++) {
                const byte = bytes[i];
                
                // ASCII ë²”ìœ„ (ì˜ë¬¸, ìˆ«ì, ê¸°ë³¸ ê¸°í˜¸)
                if (byte < 128) {
                    result += String.fromCharCode(byte);
                }
                // í•œê¸€ ë²”ìœ„ ì¶”ì • (EUC-KR)
                else if (byte >= 0xA1 && byte <= 0xFE && i + 1 < bytes.length) {
                    const nextByte = bytes[i + 1];
                    if (nextByte >= 0xA1 && nextByte <= 0xFE) {
                        // EUC-KR í•œê¸€ ì½”ë“œ ë²”ìœ„
                        const code = (byte << 8) | nextByte;
                        try {
                            // ê°„ë‹¨í•œ EUC-KR to Unicode ë³€í™˜ ì‹œë„
                            result += String.fromCharCode(code);
                        } catch (e) {
                            result += '?';
                        }
                        i++; // ë‹¤ìŒ ë°”ì´íŠ¸ ê±´ë„ˆë›°ê¸°
                    } else {
                        result += '?';
                    }
                }
                else {
                    // ê¸°íƒ€ ë¬¸ìëŠ” ê·¸ëŒ€ë¡œ ì²˜ë¦¬
                    result += String.fromCharCode(byte);
                }
            }
            
            return result;
        }

        function handleExcelFile(file) {
            // ì—‘ì…€ íŒŒì¼ì˜ ê²½ìš° ê¸°ë³¸ì ì¸ CSV í˜•íƒœë¡œ ì²˜ë¦¬
            // ì‹¤ì œ ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ì§€ë§Œ
            // ì—¬ê¸°ì„œëŠ” ì‚¬ìš©ìê°€ CSVë¡œ ì €ì¥í•œ íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì•ˆë‚´
            showUploadError('ì—‘ì…€ íŒŒì¼ì€ CSV í˜•ì‹ìœ¼ë¡œ ì €ì¥í•œ í›„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”. (íŒŒì¼ > ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥ > CSV í˜•ì‹ ì„ íƒ)');
        }

        function handleWordFile(file) {
            // ì›Œë“œ íŒŒì¼ì˜ ê²½ìš° í…ìŠ¤íŠ¸ í˜•íƒœë¡œ ì²˜ë¦¬
            // ì‹¤ì œ ì›Œë“œ íŒŒì¼ ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ì§€ë§Œ
            // ì—¬ê¸°ì„œëŠ” ì‚¬ìš©ìê°€ í…ìŠ¤íŠ¸ë¡œ ì €ì¥í•œ íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì•ˆë‚´
            showUploadError('ì›Œë“œ íŒŒì¼ì€ í…ìŠ¤íŠ¸ í˜•ì‹(.txt)ìœ¼ë¡œ ì €ì¥í•œ í›„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”. (íŒŒì¼ > ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥ > í…ìŠ¤íŠ¸ í˜•ì‹ ì„ íƒ)');
        }

        function parseTextContent(text) {
            // ë‹¤ì–‘í•œ êµ¬ë¶„ìë¡œ ë¶„ë¦¬ ì‹œë„
            let names = [];
            
            // ì¤„ë°”ê¿ˆìœ¼ë¡œ ë¶„ë¦¬
            const lines = text.split(/\r?\n/);
            for (let line of lines) {
                line = line.trim();
                if (line) {
                    // ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ê²½ìš°
                    if (line.includes(',')) {
                        const commaSeparated = line.split(',').map(name => name.trim()).filter(name => name);
                        names.push(...commaSeparated);
                    }
                    // íƒ­ìœ¼ë¡œ êµ¬ë¶„ëœ ê²½ìš°
                    else if (line.includes('\t')) {
                        const tabSeparated = line.split('\t').map(name => name.trim()).filter(name => name);
                        names.push(...tabSeparated);
                    }
                    // ê³µë°±ìœ¼ë¡œ êµ¬ë¶„ëœ ê²½ìš° (ì—¬ëŸ¬ ê³µë°±)
                    else if (line.includes('  ')) {
                        const spaceSeparated = line.split(/\s+/).map(name => name.trim()).filter(name => name);
                        names.push(...spaceSeparated);
                    }
                    // ë‹¨ì¼ ì´ë¦„
                    else {
                        names.push(line);
                    }
                }
            }
            
            // ì¤‘ë³µ ì œê±° ë° ë¹ˆ ê°’ ì œê±°
            names = [...new Set(names)].filter(name => name && name.length > 0);
            
            return names;
        }

        function updateParticipantsFromFile(names) {
            if (names.length === 0) {
                showUploadError('íŒŒì¼ì—ì„œ ì°¸ê°€ì ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (names.length > 101) {
                showUploadError(`ì°¸ê°€ìê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. (${names.length}ëª…) ìµœëŒ€ 101ëª…ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                return;
            }

            if (names.length < 2) {
                showUploadError('ìµœì†Œ 2ëª…ì˜ ì°¸ê°€ìê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            participants = names;
            document.getElementById('segmentCount').value = participants.length;
            updateParticipantsList();
            // updateWheel(); ì œê±° - íŒŒì¼ ì—…ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì›íŒì— ì ìš©í•˜ì§€ ì•ŠìŒ
            
            showUploadSuccess(`${names.length}ëª…ì˜ ì°¸ê°€ìë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! "ğŸ¯ ì›íŒì— ì ìš©í•˜ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`);
        }

        function showUploadSuccess(message) {
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.innerHTML = `<div class="upload-status upload-success">${message}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
        }

        function showUploadError(message) {
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.innerHTML = `<div class="upload-status upload-error">${message}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }

        function resetToDefault() {
            participants = ['ì°¸ê°€ì1', 'ì°¸ê°€ì2', 'ì°¸ê°€ì3', 'ì°¸ê°€ì4', 'ì°¸ê°€ì5', 'ì°¸ê°€ì6', 'ì°¸ê°€ì7', 'ì°¸ê°€ì8'];
            document.getElementById('segmentCount').value = 8;
            document.getElementById('fileInput').value = '';
            updateParticipantsList();
            updateWheel();
            
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.innerHTML = '<div class="upload-status upload-success">ê¸°ë³¸ ì°¸ê°€ì ëª©ë¡ìœ¼ë¡œ ë˜ëŒë ¸ìŠµë‹ˆë‹¤!</div>';
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 2000);
        }

        function applyParticipantsToWheel() {
            // í˜„ì¬ ì…ë ¥ëœ ì°¸ê°€ìë“¤ì„ ìˆ˜ì§‘
            const inputs = document.querySelectorAll('#participantsList input');
            const newParticipants = [];
            
            inputs.forEach(input => {
                const name = input.value.trim();
                if (name) {
                    newParticipants.push(name);
                }
            });
            
            if (newParticipants.length < 2) {
                alert('ìµœì†Œ 2ëª…ì˜ ì°¸ê°€ìê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (newParticipants.length > 101) {
                alert('ìµœëŒ€ 101ëª…ê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            participants = newParticipants;
            document.getElementById('segmentCount').value = participants.length;
            updateWheel();
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.innerHTML = `<div class="upload-status upload-success">${participants.length}ëª…ì˜ ì°¸ê°€ìê°€ ì›íŒì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
        }

        // ì´ˆê¸°í™”
        initializeParticipants();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9862371da60b723a',t:'MTc1OTA1MTc1NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
